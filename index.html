<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cek Rek - Pengecekan Nama Rekening</title>
  <meta name="description" content="Simple UI untuk cek nama rekening via backend" />
  <style>
    :root {
      --bg:#0b1220; --card:#0f1724; --muted:#9fb3c3; --accent:#06b6d4; --ok:#16a34a; --err:#ef4444;
    }
    body{font-family:system-ui,Segoe UI,Roboto,Poppins,Arial;background:linear-gradient(180deg,#061021,#071529);color:#e6eef8;margin:0;min-height:100vh;padding:28px;display:flex;align-items:center;justify-content:center}
    .card{width:100%;max-width:760px;background:linear-gradient(180deg,#071226,#071a2b);padding:22px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.6);border:1px solid rgba(255,255,255,.03)}
    h1{margin:0 0 6px 0;font-size:20px}
    p{color:var(--muted);margin:0 0 18px 0}
    label{display:block;margin-top:12px;color:var(--muted);font-weight:600;font-size:13px}
    select,input{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,.04);background:transparent;color:#fff;margin-top:6px}
    .row{display:flex;gap:12px}
    .row > *{flex:1}
    button{margin-top:14px;padding:10px 14px;border-radius:8px;border:0;background:var(--accent);color:#042d3b;font-weight:700;cursor:pointer}
    button:disabled{opacity:.6;cursor:default}
    .result{margin-top:14px;padding:12px;border-radius:8px;background:rgba(15,46,61,.6);color:#cceffd}
    .error{background:rgba(120,20,20,.6);color:#ffdede}
    .small{font-size:12px;color:var(--muted);margin-top:6px}
    footer{margin-top:18px;color:var(--muted);font-size:12px}
    .help{margin-top:10px;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <div class="card">
    <h1>CekRek — Pengecekan Nama Rekening</h1>
    <p>Masukkan bank dan nomor rekening, lalu klik "Cek". Frontend ini akan memanggil backend kamu.</p>

    <label for="bank">Pilih Bank / Provider</label>
    <select id="bank">
      <option value="">-- Pilih Bank --</option>
      <option value="002">BRI (002)</option>
      <option value="014">BCA (014)</option>
      <option value="008">Mandiri (008)</option>
      <option value="009">BNI (009)</option>
      <option value="013">CIMB Niaga (013)</option>
      <option value="gopay">GoPay (e-wallet)</option>
      <option value="ovo">OVO (e-wallet)</option>
      <option value="dana">DANA (e-wallet)</option>
      <option value="other">Lainnya (agg.)</option>
    </select>

    <label for="acct">Nomor Rekening / No. e-wallet</label>
    <input id="acct" type="text" inputmode="numeric" placeholder="contoh: 00290100012345" />

    <div class="row">
      <button id="btn">Cek Nama</button>
      <button id="clear" style="background:#334155;color:#fff">Clear</button>
    </div>

    <div id="out" class="result" style="display:none"></div>
    <div id="note" class="help">Note: Jika backend di-host di domain lain, ubah variabel <code>BACKEND_URL</code> di script.</div>
    <footer>Jangan masukkan data sensitif di frontend. Backend wajib menyimpan credential & token.</footer>
  </div>

<script>
(() => {
  // GANTI jika backend kamu beda (misal https://api.example.com)
  const BACKEND_URL = "/api/check"; // relatif → cocok jika backend di domain yang sama atau reverse-proxy

  const bankEl = document.getElementById("bank");
  const acctEl = document.getElementById("acct");
  const btn = document.getElementById("btn");
  const clear = document.getElementById("clear");
  const out = document.getElementById("out");

  function show(msg, isError=false){
    out.style.display = "block";
    out.className = "result" + (isError ? " error" : "");
    if (typeof msg === "object") out.textContent = JSON.stringify(msg, null, 2);
    else out.textContent = msg;
  }
  function hide(){ out.style.display = "none"; out.textContent = ""; }

  clear.addEventListener("click", ()=>{ acctEl.value=""; hide(); bankEl.value=""; });

  async function check(){
    hide();
    const bank = bankEl.value.trim();
    const acct = acctEl.value.trim().replace(/\s+/g,"");
    if(!bank){ show("Pilih bank dulu.", true); return; }
    if(!acct || acct.length < 6){ show("Nomor rekening tidak valid (minimal 6 digit).", true); return; }

    btn.disabled = true;
    btn.textContent = "Mencari...";

    const payload = { bankCode: bank, accountNumber: acct };

    // timeout via AbortController
    const controller = new AbortController();
    const t = setTimeout(()=>controller.abort(), 12000);

    try {
      const resp = await fetch(BACKEND_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
        signal: controller.signal
      });

      clearTimeout(t);

      if(!resp.ok){
        let txt;
        try{ txt = await resp.text(); } catch(e){ txt = resp.statusText; }
        show("Server error: " + resp.status + " — " + txt, true);
        return;
      }

      const json = await resp.json();
      // Normalisasi: backend diharapkan mengembalikan { success: bool, account_holder: string, message: ... } atau raw BRI payload
      if(json.success === false){
        show(json.message || "Tidak ditemukan.", true);
        return;
      }

      // tampilkan hasil populer
      // Prioritas: account_holder, data.accountName, data.account_holder, data
      const holder = json.account_holder || (json.data && (json.data.accountName || json.data.account_holder)) || json.data || json;
      show(holder || "Tidak ada data (format response tidak dikenali).");
    } catch(err){
      if(err.name === "AbortError") show("Timeout (coba lagi).", true);
      else show("Network error: " + (err.message || err), true);
    } finally {
      btn.disabled = false;
      btn.textContent = "Cek Nama";
    }
  }

  btn.addEventListener("click", check);
  acctEl.addEventListener("keypress", (e)=>{ if(e.key === "Enter") check(); });
})();
</script>
</body>
</html>
